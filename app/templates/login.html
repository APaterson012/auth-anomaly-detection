<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Auth Lab Login</title>
  <style>
    :root{--bg:#0b0f14;--card:#121a23;--border:#223042;--text:#e6edf3;--muted:#9fb2c7;--hint:#8aa1b8;--accent:#2d77ff;}
    body{font-family:system-ui,Arial;margin:0;display:grid;place-items:center;min-height:100vh;background:var(--bg);color:var(--text);padding:24px}
    .card{width:min(520px,92vw);background:var(--card);border:1px solid var(--border);border-radius:16px;padding:22px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
    h2{margin:0 0 8px}
    .hint{margin:0 0 14px;font-size:.9rem;color:var(--hint);line-height:1.35}
    label{display:block;margin:10px 0 6px;font-size:.9rem;color:var(--muted)}
    input{width:100%;box-sizing:border-box;height:42px;padding:10px 12px;border-radius:12px;border:1px solid var(--border);background:var(--bg);color:var(--text);font-size:.95rem}
    button{margin-top:14px;width:100%;height:42px;padding:0 12px;border:0;border-radius:12px;background:var(--accent);color:white;font-weight:700;cursor:pointer}
    .row{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
    .btnGhost{background:transparent;border:1px solid var(--border);color:var(--text)}
    .msg{margin-top:12px;font-size:.95rem}
    .pill{display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border:1px solid var(--border);border-radius:999px;font-size:.85rem;color:var(--hint);background:rgba(0,0,0,.18)}
    a{color:#b8cffc;text-decoration:none}
    a:hover{text-decoration:underline}
    code{background:var(--bg);border:1px solid var(--border);padding:2px 6px;border-radius:8px}
    .divider{height:1px;background:rgba(255,255,255,.06);margin:14px 0}
  </style>
</head>
<body>
  <div class="card">
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap;">
      <div>
        <h2>Auth Lab Login</h2>
        <p class="hint">Try incorrect logins to generate detections (brute force / stuffing).</p>
      </div>
      <div class="pill">
        <span>Live alerts:</span>
        <strong id="alertCount">0</strong>
      </div>
    </div>

    <form method="POST" action="/login">
      <label for="user">Username</label>
      <input id="user" name="user" autocomplete="username" required />

      <label for="password">Password</label>
      <input id="password" name="password" type="password" autocomplete="current-password" required />

      <button type="submit">Sign in</button>
    </form>

    <div class="row">
      <form method="POST" action="/replay" style="flex:1;min-width:220px">
        <button type="submit" class="btnGhost">▶ Replay Attack Simulation</button>
      </form>

      <a href="/download/auth.log" style="flex:1;min-width:220px">
        <button type="button" class="btnGhost" style="width:100%">⬇ Download auth.log</button>
      </a>
    </div>

    {% if msg %}
      <div class="msg">{{ msg }}</div>
    {% endif %}

    <div class="divider"></div>

    <p class="hint">
      Demo creds: <code>alice / Password123!</code>, <code>admin / Admin123!</code>
    </p>
  </div>

  <script>
    async function refreshAlerts(){
      try{
        const r = await fetch("/api/alerts/count", { cache: "no-store" });
        if(!r.ok) return;
        const j = await r.json();
        document.getElementById("alertCount").textContent = j.total ?? 0;
      }catch(e){}
    }
    refreshAlerts();
    setInterval(refreshAlerts, 2500);
  </script>
</body>
</html>